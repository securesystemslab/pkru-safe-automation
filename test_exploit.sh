#! /bin/bash

source ./sources.sh

# Save current working directory
SCWD=$(pwd)

# Exploit Folder
HTML_DIR="${BASE_PATH}/pkru-safe-cve-html"

# Start Python server with exploit page
cd $HTML_DIR
python -m SimpleHTTPServer 8192&
cd $SCWD

# Might need to run both tests a couple of times to ensure we get the address we want

# Run exploitable Servo
${ARTIFACTS_DIR}/servo-exploitable http://localhost:8192/index.html -z -f -x
${ARTIFACTS_DIR}/servo-exploitable http://localhost:8192/index.html -z -f -x
${ARTIFACTS_DIR}/servo-exploitable http://localhost:8192/index.html -z -f -x

# Run pkru Servo
${ARTIFACTS_DIR}/servo-pkru http://localhost:8192/index.html -z -f -x
${ARTIFACTS_DIR}/servo-pkru http://localhost:8192/index.html -z -f -x
${ARTIFACTS_DIR}/servo-pkru http://localhost:8192/index.html -z -f -x

# Kill the python server process
pkill python

# Pull to fg
fg

# Return to SCWD if not already
cd $SCWD
